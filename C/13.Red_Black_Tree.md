## 13. 红黑树
---

### 1. 红黑树的性质
红黑树是一棵**二叉搜索树**，它在每个结点上增加了一个存储位来表示结点的**颜色**（BLACK或RED）。通过对任何一条从根到叶子的简单路径上各个结点的颜色进行约束，红黑树可确保没有一条路径会比其他路径长2倍，因此红黑树近似为一棵**平衡二叉搜索树**。

**红黑树**满足下列5条性质：

 1. 每个结点为红色或者黑色。
 2. 根节点为黑色。
 3. 每个叶结点都是黑色。
 4. **红色结点的子结点必为黑色**。
 5. **对于每个结点，从该结点到其后代所有叶结点的简单路径上，均包含相同数量的黑色结点**。
 
 **注1**：其中前三条性质比较容易维护，而后两条性质在插入或者删除的时候很容易被破坏。<br>
 **注2**：红黑树中的叶结点指的是NIL结点，而不是普通树中定义的叶结点，如下图。
 
 <div align = center>
<img src="https://img-blog.csdnimg.cn/20190406214851458.png" width="25%" ><br>
(绘制红黑树的图时通常会省略NIL结点)
 
 <div align = left>
 
 
一棵典型的红色树如下图所示：
<div align = center>
<img src="https://img-blog.csdnimg.cn/20190406213639723.png" width="80%" >
 <div align = left>
 
 可以看到，红黑树不仅要满足上面提及的几条性质之外，还需要满足**二叉搜索树**的性质：
 1. 若任意结点的左子树不为空，则左子树上所有结点的值均小于其根节点上的值。
 2. 若任意结点的右子树不为空，则右子树上所有结点的值均大于其根节点上的值。
 3. 任意结点的左右子树也称为二叉搜索树。
 4. 二叉搜索树中没有关键字相同的结点。

此外，一棵红色树的高度满足：

<img src = "https://img-blog.csdnimg.cn/20190915100834973.png" width = "90%">

其中，`n`为红黑树内部结点的个数。由该性质可得，搜索、插入、删除等操作可在`O(lg n)`时间内完成。

### 2. 红黑树的平衡

当我们向红黑树中**插入**或者**删除**结点时，通常会不可避免的破坏红黑树的性质。因此，我们通常采取一些措施来维护被破坏的性质，常用的操作是**变色**和**旋转**。

**1. 变色操作**

下面来看看变色操作是如何维护红黑树的性质。

首先，回顾**红黑树的性质：**

 1. 每个结点为红色或者黑色。
 2. **根节点为黑色**。
 3. 每个叶结点都是黑色。
 4. **红色结点的子结点必为黑色**。
 5. 对于每个结点，从该结点到其后代所有叶结点的简单路径上，均包含相同数量的黑色结点。

其中，第四条性质在插入或者删除结点的时候最容易被破坏。

为了维护**性质5**，插入的新结点一律设置为**红色**结点，因此当插入的结点的父结点也为红色时便破坏了性质4，如下图：

<div align = center>
<img src = "https://img-blog.csdnimg.cn/20190915113405608.png" width = "80%">
<div align = left>
 
 因此，为了维护红黑树的性质，将插入的结点的父结点以及叔父结点**变色**为黑色，并将其祖父结点**变色**为红色。由于祖父结点变为了红色，可能会违反红黑树的性质，因此需要递归进行维护操作。
 
 此外，**变色**操作还灵活的应用在其他地方，如插入空树时应直接将结点变为黑色（性质2）。

**2. 旋转操作**

**红黑树的旋转**实际上和**AVL旋转**(见[AVL树](11.AVL_Tree.md))是一样的，如下图：

<div align = center>
<img src = "https://img-blog.csdnimg.cn/20190915102030952.png" width = "80%">
<div align = left>

**AVL旋转**的目的很明确：在不改变结点的前驱后继的基础上，使结点由非平衡状态变为平衡状态。

**红黑树**由于不存在平衡因子这个特性，因此**红黑旋转**的目的不是为了改善平衡性，而是和**变色**操作一样为了维护红黑树的五条性质。

下面从**红黑旋转**能改变什么特点这一视角来探讨其在维护红黑树性质方面的作用。

从上图中可以看出，**红黑旋转**有如下几个特点：
 - 1. 红黑旋转不改变结点的**前驱后继**关系。
 - 2. 红黑旋转可能改变根节点的左右子树的**黑高**。(性质5)
 
前面说到，当插入结点的父结点和叔父结点都是红色结点时，可以通过**递归变色**来维护红黑树的性质。

如果父结点为红色、叔父结点为黑色时，仅利用变色会破坏性质5（对于每个结点，从该结点到其后代所有叶结点的简单路径上，均包含相同数量的黑色结点）。

如下图：
